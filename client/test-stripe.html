<!DOCTYPE html>
<html>
<head>
    <title>Stripe Test</title>
    <script src="https://js.stripe.com/v3/"></script>
</head>
<body>
    <h1>Stripe Redirect Test</h1>
    <button onclick="testStripeRedirect()">Test Stripe Redirect</button>
    <div id="result"></div>
    
    <script>
        const stripe = Stripe('pk_test_51RjnF0BLH1BRO7tyDyIxSk84FYA9ysv0QxBoonawDRZQfsfzTneuwhV6n4adku1uoV4jnCZDaazqDY7dy3fnmQh100a4rU3CZh');
        
        async function testStripeRedirect() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                // Create a test session
                const response = await fetch('/api/create-checkout-session', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({videoId: '1'})
                });
                
                const data = await response.json();
                console.log('Session created:', data);
                
                if (data.sessionId) {
                    console.log('Stripe object:', stripe);
                    console.log('redirectToCheckout type:', typeof stripe.redirectToCheckout);
                    
                    // Use popup instead of redirect (fixes iframe restrictions)
                    const checkoutUrl = `https://checkout.stripe.com/c/pay/${data.sessionId}`;
                    const checkoutWindow = window.open(checkoutUrl, '_blank', 'width=800,height=600');
                    
                    if (checkoutWindow) {
                        resultDiv.innerHTML = 'âœ“ Checkout opened in new window - complete payment there!';
                    } else {
                        resultDiv.innerHTML = 'Error: Popup blocked. Please allow popups and try again.';
                    }
                } else {
                    resultDiv.innerHTML = 'Failed to create session: ' + JSON.stringify(data);
                }
            } catch (error) {
                console.error('Test error:', error);
                resultDiv.innerHTML = 'Error: ' + error.message;
            }
        }
    </script>
</body>
</html>